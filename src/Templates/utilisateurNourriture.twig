{% extends "base.html.twig" %}

{% block head_title %}Arcadia-Gestion du nourrissage
{% endblock %}

{% block head_description %}Gestion du nourrissage
{% endblock %}

{% block stylesheet %}
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<link rel="stylesheet" href="{{base_url}}public/scss/main.css">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
{% endblock %}

{% block body %}

	<a href="{{base_url}}">Accueil</a>
	<a href="/admin">Admin</a>
	<br><br>

	{% if addResult is defined and addResult is not empty %}

		{# Page 'résultat' suite à une action créer, update ou delete terminée -------------------------------------#}

		{# résultat de l'action #}
		{{addResult}}
		<br>

		{# Liste des éléments liés pouvant empêcher la suppression #}
			{% if data is defined and data is not empty %}
				<h2>
			Liaisons relatives à l'élément à supprimer
		</h2>
		{% endif %}
			<a href="{{ base_url }}{{previousUrl}}"> Retour</a>

	{% elseif modifySection is defined and modifySection == true %}

		{# Page 'update' pour mettre le nouveau nom -----------------------------------------------------------------#}

		<h2>Modification
			{{pageName}}:</h2>

		Ancienne date du rapport :
		{{elements.valeur}}
		<br>
		Ancien animal du rapport :
		{{ elements.nom_animal }}<br>

		Ancienne nourriture donnée :
		{{ elements.nourriture_donnee|raw }}<br>
		Ancienne quantité de nourriture :
		{{ elements.nourriture_donnee_quantite|raw }}<br>

		Nouveau :
		<br>
		<form action="{{base_url}}{{updateUrl}}" method="post" enctype='multipart/form-data'>

			<input type="hidden" name="updateElementId" value={{ elements.id }}>
			<input type="hidden" name="tok" value={{ token }}>
			<input type="hidden" name="addElementAnimal" value={{ elements.animal }}>
			
			<label for="addElementDate">Date du nourrissage :
			</label><br>
			<input type="datetime-local" name="addElementDate" id="">
			<br><br>

			<label for="addElementNou">Nourriture donnée:
			</label>
			<br>
			<input type="text" name="addElementNou" id=""><br><br>

			<label for="addElementQuant">Quantité de nourriture :
			</label>
			<br>
			<input type="text"  name="addElementQuant" id=""><br><br>

			<br>

			<button type="submit">Soumettre</button>

		</form>

		<a href="{{ base_url }}{{previousUrl}}">Retour</a>
	{% else %}

		<div class='container-fluid'>
			<div class='row justify-content-center'>
				<h1 class="col-11 col-md-9 col-lg-8 col-xl-6 col-xxl-5 m-5 text-center">Bienvenue dans votre espace de gestion du nourrissage</h1>
			</div>
		</div>

		<br>
		<div class='container-fluid'>
			<div class='row justify-content-center'>
				<h2 class="col-11 col-md-9 col-lg-8 col-xl-6 col-xxl-5 m-5 text-center">Que voulez vous faire ?</h2>
			</div>
		</div>


		{# Page 'main' de la section avec CRUD ----------------------------------------------------------------------#}

		<div class='container-fluid'>
			<div class='row justify-content-start'>
				<h2 class="col-12 m-2">liste des
					nourrissages</h2>
			</div>

			{# Formulaire de recherche #}
			<form action="{{base_url}}{{previousUrl}}" method="get" enctype='multipart/form-data'>
				<input type="text" name='search'>
				<input type="hidden" name="tok" value={{ token }}>
				<button type="submit">Recherche
					{{pageName}}</button>
				<button onclick="location.href='{{ base_url }}{{previousUrl}}'">Reset</button>
			</form>

			{% if elements == 'une erreur est survenue' %}
				<b>une erreur est survenue</b>
			{% else %}

				{# Tableau des éléments #}
				<table>
					<thead>
						<tr>
							<th>Date et heure</th>
							<th>Animal</th>
							<th>Nourriture donnée</th>
							<th>Quantité</th>
							<th>Etat Animal</th>
							<th>Nourriture proposée par le vétérinaire</th>
							<th>Quantité proposée par le vétérinaire</th>
							<th>Dernier rapport vétérinaire</th>
							<th>Modifier</th>
							<th>Supprimer</th>
						</tr>
					</thead>

					<tbody>
						{% for element in elements %}
							<tr>
								<td>{{ element.valeur|raw  }}</td>
								<td>{{ element.nom_animal }}</td>
								<td>{{ element.nourriture_donnee|raw  }}</td>
								<td>{{ element.nourriture_donnee_quantite|raw }}</td>
								<td>{{ element.etat_sante|raw  }}</td>
								<td>{{ element.info_veterinaire|raw  }}</td>
								<td>{{ element.quantite_veterinaire|raw  }}</td>
								<td>{{ element.date_rapport_veterinaire_format|raw  }}</td>

								<td>
									<form method="get" action="{{base_url}}{{updateUrl}}" enctype='multipart/form-data'>
										<input type="hidden" name="UpdateElementId" value={{ element.id }}>
										<input type="hidden" name="tok" value={{ token }}>
										<button type="submit">Modifier</button>
									</form>
								</td>

								<td>
									<form method="post" action="{{base_url}}{{deleteUrl}}" enctype='multipart/form-data'>
										<input type="hidden" name="deleteElementId" value={{ element.id }}>
										<input type="hidden" name="tok" value={{ token }}>
										<button type="submit">Supprimer</button>
									</form>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>

				{# Pagination #}
				<div class="pagination">
					page
					<br>
					{% if activePage > 1 %}
						<a href="?page={{ activePage - 1 }}&search={{search}}&tok={{token}}">Page précédente</a>
					{% endif %}

					{% for page in 1..pageMax %}
						{% if page == activePage %}
							<span class="current-page">{{ page }}</span>
						{% else %}
							<a href="?page={{ page }}&search={{search}}&tok={{token}}">{{ page }}</a>
						{% endif %}
					{% endfor %}

					{% if activePage < pageMax %}
						<a href="?page={{ activePage + 1 }}&search={{search}}&tok={{token}}">Page suivante</a>
					{% endif %}
				</div><br>
			</div>

		{% endif %}


		<h2>Souhaitez vous faire un ajout : Nourrissage ?</h2>

		<form id='addelement' action="{{base_url}}{{addUrl}}" method="post" enctype='multipart/form-data'>
			<label for="addElementDate">Date du nourrissage :
			</label><br>
			<input type="datetime-local" required name="addElementDate" id="">
			<br><br>

			<!-- Champ de saisie pour la recherche -->
			<label for="searchInput">Recherche de l'animal pour le select:</label><br>
			<input type="text" id="searchInput" onkeyup="rechercheSelect()" placeholder="Rechercher..."><br><br>

			<label for="addElementAnimal">Animal :
			</label><br>
			<select name="addElementAnimal" id="select_animal">
				<option value=""></option>
				{% for item in animaux %}
					<option value="{{ item.id }}">{{ item.valeur }}</option>
				{% endfor %}
			</select><br><br>

			<label for="addElementNou">Nourriture donnée:
			</label>
			<br>
			<input type="text" required name="addElementNou" id=""><br><br>

			<label for="addElementQuant">Quantité de nourriture :
			</label>
			<br>
			<input type="text" required name="addElementQuant" id=""><br><br>

			<br>

			<input type="hidden" name="tok" value={{ token }}>
			<button type="submit">Soumettre</button>
		</form>
		{# Retour vers page d'accueil admin #}
		<a href="{{base_url}}admin">Retour</a>

		<script>
			// Fonction de recherche
function rechercheSelect() { // Récupérer la valeur de recherche
let input,
filter,
select,
options,
option,
i,
txtValue;
input = document.getElementById("searchInput");
filter = input.value.toUpperCase();
select = document.getElementById("select_animal");
options = select.getElementsByTagName("option");

// Masquer les options qui ne correspondent pas à la recherche
for (i = 0; i < options.length; i++) {
option = options[i];
txtValue = option.textContent || option.innerText;
if (txtValue.toUpperCase().indexOf(filter) > -1) {
option.style.display = "";
} else {
option.style.display = "none";
}
}
}
		</script>
	{% endif %}
{% endblock %}
